<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-orange-50 via-white to-green-50 p-6">
  <div class="w-full max-w-4xl bg-white shadow-2xl rounded-3xl p-8 border border-orange-200">

    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-extrabold text-orange-600 mb-2">Créer une publicité</h1>
      <p class="text-gray-700 text-lg">Remplissez les informations pour publier votre publicité.</p>
    </div>

    <!-- Formulaire -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">

      <!-- Titre -->
      <div>
        <label class="block text-gray-700 font-medium mb-2">Titre *</label>
        <input
          type="text"
          formControlName="title"
          class="w-full border border-gray-300 rounded-lg p-3 text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-orange-400 focus:outline-none"
          [class.border-red-500]="form.get('title')?.invalid && form.get('title')?.touched"
          placeholder="Ex: Promotion spéciale sur nos produits" />

        @if (form.get('title')?.invalid && form.get('title')?.touched) {
          <small class="text-red-600 mt-1 block">
            @if (form.get('title')?.errors?.['required']) {
              Le titre est requis
            }
            @if (form.get('title')?.errors?.['minlength']) {
              Le titre doit contenir au moins 5 caractères
            }
          </small>
        }
      </div>

      <!-- Lien -->
      <div>
        <label class="block text-gray-700 font-medium mb-2">Lien de destination *</label>
        <input
          type="url"
          formControlName="link"
          class="w-full border border-gray-300 rounded-lg p-3 text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-orange-400 focus:outline-none"
          [class.border-red-500]="form.get('link')?.invalid && form.get('link')?.touched"
          placeholder="https://exemple.com" />

        @if (form.get('link')?.invalid && form.get('link')?.touched) {
          <small class="text-red-600 mt-1 block">
            @if (form.get('link')?.errors?.['required']) {
              Le lien est requis
            }
            @if (form.get('link')?.errors?.['pattern']) {
              Le lien doit commencer par http:// ou https://
            }
          </small>
        }
      </div>

      <!-- Image -->
      <div>
        <label class="block text-gray-700 font-medium mb-2">Image publicitaire *</label>

        @if (!imagePreview) {
          <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center bg-orange-50 hover:bg-orange-100 transition cursor-pointer"
               [class.border-red-500]="form.get('image')?.invalid && form.get('image')?.touched">
            <input
              type="file"
              accept="image/*"
              (change)="onFileSelect($event)"
              class="hidden"
              #fileInput />

            <button
              type="button"
              (click)="fileInput.click()"
              class="w-full">
              <i class="pi pi-cloud-upload text-4xl text-orange-500 mb-3"></i>
              <p class="text-gray-700 font-medium mb-1">Cliquez pour télécharger une image</p>
              <p class="text-sm text-gray-500">Formats acceptés : JPG, PNG, GIF (max 2 Mo)</p>
            </button>
          </div>
        } @else {
          <div class="relative border-2 border-gray-300 rounded-xl overflow-hidden">
            <img [src]="imagePreview" alt="Aperçu" class="w-full h-64 object-cover" />
            <button
              type="button"
              (click)="removeImage()"
              class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-2 hover:bg-red-600 transition">
              <i class="pi pi-times"></i>
            </button>
          </div>
        }

        @if (form.get('image')?.invalid && form.get('image')?.touched) {
          <small class="text-red-600 mt-1 block">L'image est requise</small>
        }
      </div>

      <!-- Date et durée -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- Date de début -->
        <div>
          <label class="block text-gray-700 font-medium mb-2">Date de début *</label>
          <input
            type="date"
            formControlName="start_date"
            [min]="today"
            class="w-full border border-gray-300 rounded-lg p-3 text-gray-800 focus:ring-2 focus:ring-orange-400 focus:outline-none"
            [class.border-red-500]="form.get('start_date')?.invalid && form.get('start_date')?.touched" />

          @if (form.get('start_date')?.invalid && form.get('start_date')?.touched) {
            <small class="text-red-600 mt-1 block">La date de début est requise</small>
          }
        </div>

        <!-- Nombre de jours -->
        <div>
          <label class="block text-gray-700 font-medium mb-2">Nombre de jours *</label>
          <input
            type="number"
            formControlName="duration_days"
            min="1"
            class="w-full border border-gray-300 rounded-lg p-3 text-gray-800 focus:ring-2 focus:ring-orange-400 focus:outline-none"
            [class.border-red-500]="form.get('duration_days')?.invalid && form.get('duration_days')?.touched" />

          @if (form.get('duration_days')?.invalid && form.get('duration_days')?.touched) {
            <small class="text-red-600 mt-1 block">
              @if (form.get('duration_days')?.errors?.['required']) {
                La durée est requise
              }
              @if (form.get('duration_days')?.errors?.['min']) {
                La durée minimale est de 1 jour
              }
            </small>
          }
        </div>
      </div>

      <!-- Récapitulatif du prix -->
      <div class="bg-gradient-to-r from-orange-50 to-green-50 rounded-xl p-6 border border-orange-200">
        <h3 class="text-lg font-bold text-gray-800 mb-4">Récapitulatif</h3>

        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-700">Prix par jour:</span>
            <span class="font-semibold text-gray-800">{{ pricePerDay | number }} FCFA</span>
          </div>

          <div class="flex justify-between items-center">
            <span class="text-gray-700">Nombre de jours:</span>
            <span class="font-semibold text-gray-800">{{ form.get('duration_days')?.value || 0 }}</span>
          </div>

          <div class="flex justify-between items-center">
            <span class="text-gray-700">Durée totale:</span>
            <span class="font-semibold text-gray-800">{{ durationHours }} heures</span>
          </div>

          <div class="border-t border-orange-300 pt-3 mt-3">
            <div class="flex justify-between items-center">
              <span class="text-lg font-bold text-gray-800">Prix total:</span>
              <span class="text-2xl font-bold text-green-600">{{ totalPrice | number }} FCFA</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Note d'information -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-start space-x-3">
          <i class="pi pi-info-circle text-blue-600 text-xl mt-1"></i>
          <div class="text-sm text-blue-800">
            <p class="font-medium mb-1">Informations importantes:</p>
            <ul class="list-disc list-inside space-y-1">
              <li>Votre publicité sera visible après validation du paiement</li>
              <li>Elle sera affichée de manière aléatoire sur la plateforme</li>
              <li>Vous pourrez suivre les statistiques (impressions, clics)</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Boutons -->
      <div class="flex justify-end space-x-4 pt-4">
        <button
          type="button"
          (click)="cancel()"
          [disabled]="isSubmitting()"
          class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">
          Annuler
        </button>

        <button
          type="submit"
          [disabled]="form.invalid || isSubmitting()"
          class="px-8 py-3 bg-gradient-to-r from-orange-500 to-green-500 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
          @if (isSubmitting()) {
            <i class="pi pi-spin pi-spinner mr-2"></i>
            Création en cours...
          } @else {
            <i class="pi pi-check-circle mr-2"></i>
            Créer et payer
          }
        </button>
      </div>

    </form>

    <!-- Toast -->
    <p-toast position="bottom-right"></p-toast>
  </div>
</div>
