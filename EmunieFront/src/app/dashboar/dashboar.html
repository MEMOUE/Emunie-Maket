<div class="min-h-screen bg-gradient-to-br from-gray-50 to-orange-50">
  <div class="max-w-7xl mx-auto px-4 py-8">

    <!-- Header Dashboard -->
    <div class="mb-8">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-900 mb-2">Tableau de bord</h1>
          <p class="text-gray-600">
            Bienvenue {{ currentUser()?.first_name }} !
            @if (currentUser()?.is_premium_active) {
              <span class="inline-flex items-center gap-1 text-orange-600 font-semibold">
                <i class="pi pi-star-fill"></i>
                Compte Premium actif
              </span>
            }
          </p>
        </div>
        <div class="flex gap-3">
          @if (!currentUser()?.is_premium_active) {
            <button
              (click)="openPremiumDialog()"
              class="px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all flex items-center gap-2 font-semibold shadow-lg">
              <i class="pi pi-star-fill"></i>
              Passer Premium
            </button>
          }
          <button
            (click)="createNewAd()"
            class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all flex items-center gap-2 font-semibold shadow-lg">
            <i class="pi pi-plus-circle"></i>
            Nouvelle annonce
          </button>
        </div>
      </div>
    </div>

    <!-- Statistiques -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
      <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <div class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center">
            <i class="pi pi-list text-2xl text-blue-600"></i>
          </div>
          <span class="text-3xl font-bold text-gray-900">{{ stats().totalAds }}</span>
        </div>
        <h3 class="text-gray-600 font-medium">Annonces totales</h3>
      </div>

      <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <div class="bg-green-100 w-12 h-12 rounded-lg flex items-center justify-center">
            <i class="pi pi-check-circle text-2xl text-green-600"></i>
          </div>
          <span class="text-3xl font-bold text-gray-900">{{ stats().activeAds }}</span>
        </div>
        <h3 class="text-gray-600 font-medium">Annonces actives</h3>
      </div>

      <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <div class="bg-orange-100 w-12 h-12 rounded-lg flex items-center justify-center">
            <i class="pi pi-eye text-2xl text-orange-600"></i>
          </div>
          <span class="text-3xl font-bold text-gray-900">{{ stats().totalViews }}</span>
        </div>
        <h3 class="text-gray-600 font-medium">Vues totales</h3>
      </div>

      <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <div class="bg-red-100 w-12 h-12 rounded-lg flex items-center justify-center">
            <i class="pi pi-heart text-2xl text-red-600"></i>
          </div>
          <span class="text-3xl font-bold text-gray-900">{{ stats().totalFavorites }}</span>
        </div>
        <h3 class="text-gray-600 font-medium">Favoris</h3>
      </div>

      <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <div class="bg-purple-100 w-12 h-12 rounded-lg flex items-center justify-center">
            <i class="pi pi-clock text-2xl text-purple-600"></i>
          </div>
          <span class="text-3xl font-bold text-gray-900">{{ stats().pendingAds }}</span>
        </div>
        <h3 class="text-gray-600 font-medium">En attente</h3>
      </div>
    </div>

    <!-- Tabs Principal -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
      <p-tab [(activeIndex)]="activeTab">

        <!-- Tab: Mes Annonces -->
        <p-tab header="Mes Annonces" leftIcon="pi pi-list">
          <div class="p-6">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-xl font-bold text-gray-900">
                Mes annonces ({{ myAds().length }})
              </h2>
              <div class="text-sm text-gray-600">
                Annonces restantes:
                <span class="font-bold text-orange-600">{{ getRemainingAds() }}</span>
                @if (currentUser()?.is_premium_active) {
                  <span class="text-green-600">/ ∞</span>
                } @else {
                  <span>/ 5</span>
                }
              </div>
            </div>

            <p-table [value]="myAds()" [tableStyle]="{ 'min-width': '50rem' }" styleClass="p-datatable-striped">
              <ng-template pTemplate="header">
                <tr>
                  <th>Annonce</th>
                  <th>Prix</th>
                  <th>Catégorie</th>
                  <th>Statut</th>
                  <th>Vues</th>
                  <th>Favoris</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-ad>
                <tr>
                  <td>
                    <div class="flex items-center gap-3">
                      @if (ad.is_promoted) {
                        <i class="pi pi-bolt text-orange-500" title="Annonce promue"></i>
                      }
                      <span class="font-semibold">{{ ad.title }}</span>
                    </div>
                  </td>
                  <td class="font-bold text-orange-600">{{ formatPrice(ad.price) }}</td>
                  <td>{{ ad.category }}</td>
                  <td>
                    <p-tag [value]="getStatusLabel(ad.status)"></p-tag>
                  </td>
                  <td>
                    <span class="flex items-center gap-1">
                      <i class="pi pi-eye text-gray-500"></i>
                      {{ ad.views }}
                    </span>
                  </td>
                  <td>
                    <span class="flex items-center gap-1">
                      <i class="pi pi-heart text-red-500"></i>
                      {{ ad.favorites }}
                    </span>
                  </td>
                  <td>{{ formatDate(ad.created_at) }}</td>
                  <td>
                    <div class="flex gap-2">
                      <button
                        (click)="editAd(ad)"
                        class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                        title="Modifier">
                        <i class="pi pi-pencil"></i>
                      </button>
                      <button
                        (click)="openPromotionDialog(ad)"
                        class="p-2 text-orange-600 hover:bg-orange-50 rounded-lg transition-colors"
                        title="Promouvoir">
                        <i class="pi pi-bolt"></i>
                      </button>
                      <button
                        (click)="deleteAd(ad)"
                        class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                        title="Supprimer">
                        <i class="pi pi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="8" class="text-center py-8">
                    <div class="flex flex-col items-center gap-4">
                      <i class="pi pi-inbox text-6xl text-gray-300"></i>
                      <p class="text-gray-500">Vous n'avez pas encore d'annonces</p>
                      <button
                        (click)="createNewAd()"
                        class="px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                        Créer ma première annonce
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </p-tab>

        <!-- Tab: Promotions -->
        <p-tab header="Promouvoir" leftIcon="pi pi-bolt">
          <div class="p-6">
            <div class="mb-6">
              <h2 class="text-2xl font-bold text-gray-900 mb-2">Boostez vos annonces</h2>
              <p class="text-gray-600">Augmentez la visibilité de vos annonces avec nos options de promotion</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              @for (promo of promotions; track promo.id) {
                <div class="bg-white border-2 rounded-xl p-6 hover:border-orange-500 hover:shadow-xl transition-all relative"
                     [class.border-orange-500]="promo.popular">
                  @if (promo.popular) {
                    <span class="absolute -top-3 right-4 bg-orange-500 text-white px-3 py-1 rounded-full text-xs font-semibold">
                      Populaire
                    </span>
                  }

                  <div class="bg-gradient-to-br from-{{promo.color}}-100 to-{{promo.color}}-200 w-16 h-16 rounded-xl flex items-center justify-center mb-4">
                    <i class="pi {{promo.icon}} text-3xl text-{{promo.color}}-600"></i>
                  </div>

                  <h3 class="text-xl font-bold text-gray-900 mb-2">{{ promo.name }}</h3>
                  <p class="text-2xl font-bold text-orange-600 mb-2">{{ formatPrice(promo.price) }}</p>
                  <p class="text-sm text-gray-600 mb-4">{{ promo.description }}</p>
                  <div class="text-xs text-gray-500 mb-4">
                    <i class="pi pi-clock"></i>
                    Durée: {{ promo.duration }}
                  </div>

                  <button
                    class="w-full py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all font-semibold">
                    Acheter
                  </button>
                </div>
              }
            </div>

            <!-- Avantages Premium -->
            @if (!currentUser()?.is_premium_active) {
              <div class="mt-8 bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white">
                <div class="flex items-center justify-between">
                  <div>
                    <h3 class="text-xl font-bold mb-2">Devenez Premium et économisez !</h3>
                    <p class="text-orange-100">Obtenez des promotions gratuites chaque mois</p>
                  </div>
                  <button
                    (click)="openPremiumDialog()"
                    class="px-6 py-3 bg-white text-orange-600 rounded-lg hover:bg-orange-50 transition-colors font-semibold flex items-center gap-2">
                    <i class="pi pi-star-fill"></i>
                    Voir les offres
                  </button>
                </div>
              </div>
            }
          </div>
        </p-tab>

        <!-- Tab: Premium -->
        <p-tab header="Devenir Premium" leftIcon="pi pi-star-fill">
          <div class="p-6">
            <div class="text-center mb-8">
              <h2 class="text-3xl font-bold text-gray-900 mb-2">Choisissez votre plan Premium</h2>
              <p class="text-gray-600 text-lg">Débloquez tout le potentiel de vos annonces</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              @for (plan of premiumPlans; track plan.id) {
                <div class="bg-white border-2 rounded-xl p-8 hover:border-orange-500 hover:shadow-2xl transition-all relative"
                     [class.border-orange-500]="plan.popular"
                     [class.scale-105]="plan.popular">
                  @if (plan.popular) {
                    <span class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-2 rounded-full text-sm font-bold shadow-lg">
                      Le plus populaire
                    </span>
                  }

                  <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">{{ plan.name }}</h3>
                    <div class="mb-2">
                      <span class="text-4xl font-bold text-orange-600">{{ formatPrice(plan.price) }}</span>
                    </div>
                    <p class="text-gray-600">{{ plan.duration }}</p>
                  </div>

                  <ul class="space-y-3 mb-8">
                    @for (feature of plan.features; track feature) {
                      <li class="flex items-start gap-2">
                        <i class="pi pi-check-circle text-green-500 mt-1"></i>
                        <span class="text-gray-700">{{ feature }}</span>
                      </li>
                    }
                  </ul>

                  <button
                    (click)="subscribeToPremium(plan)"
                    class="w-full py-3 rounded-lg font-bold transition-all"
                    [class]="plan.popular
                      ? 'bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 shadow-lg'
                      : 'bg-gray-100 text-gray-900 hover:bg-gray-200'">
                    @if (currentUser()?.is_premium_active) {
                      Changer de plan
                    } @else {
                      Souscrire maintenant
                    }
                  </button>
                </div>
              }
            </div>

            <!-- Garanties -->
            <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="text-center">
                <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="pi pi-shield text-3xl text-green-600"></i>
                </div>
                <h4 class="font-bold text-gray-900 mb-2">Paiement sécurisé</h4>
                <p class="text-sm text-gray-600">Toutes vos transactions sont protégées</p>
              </div>
              <div class="text-center">
                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="pi pi-sync text-3xl text-blue-600"></i>
                </div>
                <h4 class="font-bold text-gray-900 mb-2">Annulation flexible</h4>
                <p class="text-sm text-gray-600">Résiliez à tout moment sans frais</p>
              </div>
              <div class="text-center">
                <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="pi pi-headphones text-3xl text-purple-600"></i>
                </div>
                <h4 class="font-bold text-gray-900 mb-2">Support dédié</h4>
                <p class="text-sm text-gray-600">Une équipe à votre écoute 24/7</p>
              </div>
            </div>
          </div>
        </p-tab>

        <!-- Tab: Paramètres -->
        <p-tab header="Paramètres" leftIcon="pi pi-cog">
          <div class="p-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Paramètres du compte</h2>

            <div class="space-y-6">
              <!-- Informations personnelles -->
              <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Informations personnelles</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="text-sm font-semibold text-gray-700">Nom complet</label>
                    <p class="text-gray-900">{{ currentUser()?.full_name }}</p>
                  </div>
                  <div>
                    <label class="text-sm font-semibold text-gray-700">Email</label>
                    <p class="text-gray-900">{{ currentUser()?.email }}</p>
                  </div>
                  <div>
                    <label class="text-sm font-semibold text-gray-700">Téléphone</label>
                    <p class="text-gray-900">{{ currentUser()?.phone_number || 'Non renseigné' }}</p>
                  </div>
                  <div>
                    <label class="text-sm font-semibold text-gray-700">Localisation</label>
                    <p class="text-gray-900">{{ currentUser()?.location || 'Non renseignée' }}</p>
                  </div>
                </div>
                <button class="mt-4 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                  Modifier mes informations
                </button>
              </div>

              <!-- Statut Premium -->
              @if (currentUser()?.is_premium_active) {
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white">
                  <div class="flex items-center justify-between">
                    <div>
                      <h3 class="text-lg font-bold mb-2 flex items-center gap-2">
                        <i class="pi pi-star-fill"></i>
                        Abonnement Premium actif
                      </h3>
                      <p class="text-orange-100">
                        Expire le: {{ formatDate(currentUser()?.premium_end_date || '') }}
                      </p>
                    </div>
                    <button class="px-4 py-2 bg-white text-orange-600 rounded-lg hover:bg-orange-50 transition-colors font-semibold">
                      Gérer l'abonnement
                    </button>
                  </div>
                </div>
              }

              <!-- Notifications -->
              <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Préférences de notification</h3>
                <div class="space-y-3">
                  <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" checked class="w-4 h-4 text-orange-600 rounded">
                    <span class="text-gray-700">Recevoir les notifications par email</span>
                  </label>
                  <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" checked class="w-4 h-4 text-orange-600 rounded">
                    <span class="text-gray-700">Alertes pour les nouvelles vues</span>
                  </label>
                  <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" class="w-4 h-4 text-orange-600 rounded">
                    <span class="text-gray-700">Newsletter et offres spéciales</span>
                  </label>
                </div>
              </div>

              <!-- Sécurité -->
              <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Sécurité</h3>
                <button class="px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors">
                  Changer mon mot de passe
                </button>
              </div>
            </div>
          </div>
        </p-tab>

      </p-tab>
    </div>

  </div>
</div>

<!-- Dialog Premium -->
<p-dialog
  [(visible)]="showPremiumDialog"
  [modal]="true"
  [style]="{ width: '90vw', maxWidth: '1200px' }"
  header="Choisissez votre plan Premium">

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-4">
    @for (plan of premiumPlans; track plan.id) {
      <div class="border-2 rounded-xl p-6 hover:border-orange-500 transition-all"
           [class.border-orange-500]="plan.popular">
        @if (plan.popular) {
          <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-xs font-bold mb-4 inline-block">
            Populaire
          </span>
        }

        <h3 class="text-xl font-bold mb-2">{{ plan.name }}</h3>
        <div class="text-3xl font-bold text-orange-600 mb-2">{{ formatPrice(plan.price) }}</div>
        <p class="text-gray-600 mb-4">{{ plan.duration }}</p>

        <ul class="space-y-2 mb-6">
          @for (feature of plan.features; track feature) {
            <li class="flex items-start gap-2 text-sm">
              <i class="pi pi-check text-green-500 mt-1"></i>
              <span>{{ feature }}</span>
            </li>
          }
        </ul>

        <button
          (click)="subscribeToPremium(plan)"
          class="w-full py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-semibold">
          Choisir ce plan
        </button>
      </div>
    }
  </div>
</p-dialog>

<!-- Dialog Promotion -->
<p-dialog
  [(visible)]="showPromotionDialog"
  [modal]="true"
  [style]="{ width: '90vw', maxWidth: '800px' }"
  [header]="'Promouvoir: ' + (selectedAd()?.title || '')">

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
    @for (promo of promotions; track promo.id) {
      <div class="border-2 rounded-xl p-6 hover:border-orange-500 hover:shadow-lg transition-all cursor-pointer"
           (click)="promoteAd(selectedAd()!, promo)">
        <div class="flex items-start justify-between mb-4">
          <div class="bg-{{promo.color}}-100 w-12 h-12 rounded-lg flex items-center justify-center">
            <i class="pi {{promo.icon}} text-2xl text-{{promo.color}}-600"></i>
          </div>
          @if (promo.popular) {
            <span class="bg-orange-500 text-white px-2 py-1 rounded text-xs font-bold">Top</span>
          }
        </div>

        <h3 class="text-lg font-bold mb-2">{{ promo.name }}</h3>
        <p class="text-2xl font-bold text-orange-600 mb-2">{{ formatPrice(promo.price) }}</p>
        <p class="text-sm text-gray-600 mb-2">{{ promo.description }}</p>
        <p class="text-xs text-gray-500">
          <i class="pi pi-clock"></i>
          {{ promo.duration }}
        </p>
      </div>
    }
  </div>
</p-dialog>
